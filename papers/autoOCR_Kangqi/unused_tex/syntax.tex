\section{Syntax of OCR Description Lanuage}
\label{sec:syntax}
% Describe the syntax of the description language.
% \begin{enumerate}
% \item Syntax for the description language, including CFG and type
% system;
% \item Emphasize the description about spatial information (differences with pads) and constrains;
% \item Description examples.
% \end{enumerate}

%In this section, we briefly describe what an ODL data description looks like by presenting some illustrative examples.
%
In this section, we introduce the OCR description language in detail,
and explain what kind of structured data that ODL is able to describe.
The abstract syntax of ODL is formally described in \figref{fig:syntax}.
ODL is able to describe both structured data and
spatial layouts of textual information within a medical image.
In the following parts, we will discuss the ODL syntax and its type system in more detail.
\input{syntaxfig}

\subsubsection{Values}

% \KZ{Discuss what types of values are there, sand it relationship with the
% expression. Basically expression can be parsed into values. Constants
% can also be any of the values. Need to explain len, coord, etc. There's no
% such thing as $v_1$ | $v_2$ | ..| $v_n$. I removed it.}

% \KZ{Is it coor or coord? Make it consistent thruout the paper.}
\KQ{value: building blocks of complex semantics.}
Basically, all expressions in ODL can be parsed into values.
Values in ODL can take the form of extracted textual information or the spatial parameters.
%\JL{
	We can see that a value can take on many different shapes
in \figref{fig:syntax}. For example, \textit{()} can be regarded as a value.
\textit{int},
\textit{float} and \textit{string} can also be regarded as values.
%}
\textit{len} and \textit{coor} are two special value types in ODL.
They indicate the values of spatial parameters.
\textit{len} contains two parameters: the length and the unit for the spatial description.
\textit{coor} indicates the values of those coordinates, and it contains four \textit{len} values representing
the coordinates of the top left corner and the bottom right corner of
the region of interest (see it in \figref{fig:syntax}).
The last definition for value  \textit{$\{v_1, ..., v_n\}$} indicates that a struct which contains many values can also be defined as a value.

\subsubsection{Primitive Expression}
Primitive expressions include \textit{constant value} and \textit{name},
which are the first two definitions for expression.
%The idea of ODL is to describe the data information on images
%based on the data type.
%This idea comes from PADS, which uses types to describe ad hoc data \cite{fisher2011pads}.
%\textit{Constant} and \textit{name} are the basic data description
%expressions in ODL.
\KQ{intuition: constant: for fixed values in the image, or spatial constraint; name: represent variables in the image.
Can we split the usage of constant? value for value, spatial for spatial.}
Constant values can represent fixed-valued strings or numerical values
to be recognized from the image.
In \figref{fig:absdes}, the key name ``Vent. rate'' and the unit
``bpm'' for the medical test are constant expressions in all ECGs of the same
format. Constants are usually markers or delimiters in semi-structured
data formats.
%For ECGs in the same format, the key name for the test value is always
%``Vent. rate'' and the unit for the test value is always ``bpm''.
On the other hand, if a data field has variable values,
but we know the data type or the constraints of the data field,
(e.g., a numeric type), we can use a \textit{name}.
In \figref{fig:absdes}, the value for ``Vent. rate'' is a variable by
the patient and their different medical tests, we use a name $x$ to represent that.
\KZ{Put this into constraint part:
In addition, we know that the value for ``Vent. rate'' should be an integer
between 60 and 100, so we combine \textit{name} and \textit{constraints}
to describe the whole field.}
%With the help of \textit{constant} and \textit{name}, ODL can be used for
%describing a data form by using \textit{constant} for shared data
%information and \textit{name} for different data on individual images.

\subsubsection{Spatial Expression}
Spatial description expressions include % \textit{function},
\textit{hskip e} and \textit{vskip e}.
These are essential constructs for ODL to describe spaces in the images.
For ODL, an image document can be considered the combination of
one or more text areas, or text boxes. In \figref{fig:ecgexample2},
there are four separate text boxes on the image.
%In this case, we designed ODL with expressions for describing
%this spatial information.
In ODL, the text boxes are described by using the coordinates of
the corners of the box. This coordinates information also serves to define
constraints. Text boxes can be specified if we want
to describe the layout on large scale.
% \KZ{What's the diff between information box and text box?}
\textit{hskip e} and \textit{vskip e} can be used for describing
approximate distances horizontally or vertically.
\KZ{What's e here? I suppose it's just len/$\backslash$s/$\backslash$n.
Yes, type system told us so.}
%So in ODL, rough spatial description can also be used to indicate
%that there is a small space or there is a large space.
%\JL{
The detailed process of choosing final results with the
help of spatial description will be discussed later
in section \ref{sec:semantics}.
%}
% Fuzzy matching the layout description with the real input
% will be discussed later in section \ref{sec:semantics}.
Since spatial information is usually described together with the
measurement unit, like pixel or centimeter,
the spatial description expression in ODL can only
be generated with ``len'' expressions.
In the example, the coordinates of the upper left corner and
the bottom right corner for four main parts of the image are outlined in the
constraints and the symbol ``\_'' means default, which means the
coordinates of the upper left corner and the bottom right corner of the
whole document. \textit{hskip $\backslash$s} indicates that there are some spaces
between the key ``Vent. rate'' and the value $x$. And \textit{vskip $\backslash$s}
indicates that there are some vertical spaces between information about
interpretation and parameters.
% \KZ{Why not also $vskip~\backslash s$?}

\subsubsection{Composition}
Composition expressions are compound expressions constructed from other
expressions. These include
\textit{struct}, \textit{union}, \textit{list},
\textit{constraints}, \textit{binding} and \textit{bop}.

%With the help of the two kinds of expressions before, we can describe what's on the image and where are they. We combine these two parts in ODL by using complex type expressions. In the example, \textit{struct}, \textit{union} and \textit{list} is used.
\textit{Struct} is used to describe a text box by using both data description
expressions and spatial information description expressions as its primary contents.
In \textit{struct}, all sub-expressions are described in a sequence,
and the default sequence is from left to right and from top to bottom. In the struct description for ``tuples'', key, value and unit are listed from left to right.
Exceptions happen when the space skip function is applied to a negative number, which means moving the cursor backwards.
\textit{Union} means there are many potential data or potential spatial operations to consider. The union description for ``month'' is the enumeration of all abbreviations of the names of the months.
\textit{List} is used to indicate that a sequence of similar data or the same spatial operations should be applied multiple times. In the example, \textit{list} is used to indicate that there are many blank lines between descriptions for interpretation and parameters.

Other expressions like \textit{binding} and \textit{bop} are designed to
simplify the description and make ODL more expressive.
The function of \textit{binding} is to give a name \textit{x} to
the expression \textit{e} so that we can reuse the parsing result of \textit{e}
in the latter description.
\KZ{Can say a bit more about what is the purpose of binding.}
\KQ{binding is used for reusing variable names: triple.x0, triple.y0 ..., but how can I explain such things?}

\textit{Constraints} can
be set based on both data description expressions and
spatial description expressions. In ODL, constraints can be put on
% primitive expressions or composition expressions.
data or a text box.
\KZ{What's the difference between data and a text box?}
\KQ{data: a single variable; text box: treat as positional information of a variable (could be a single number, of some larger struct.)}
\KZ{only two constraints: data and spatial.}
Detailed constraints on data can be about the
type of the data or the value of the data, while constraints for a
text box are coordinates that specify the spatial boundaries of the text box.


% \figref{fig:ecgexample} gives an example ECG report. An ECG report
% contains values for different attributes.
% Those values are important for doctors to know the physical condition
% of patients and make decisions about the treatment.
% For most of the medical images, values of different test results
% usually appear in the similar key-value pair format.
% In this case, we propose ODL data description language to describe the
% structured information on medical images easily and extract them efficiently.

% \begin{figure}[h]
% \begin{eqnarray*}
% &&\{``Vent.", ``rate", Oint ~~ valueVent, (hskip ``s"), ``bpm", (vskip ``n")\} ~~ as ~~ triples\\
% &&triples_{(imageWidth/10, default, imageWidth/2, default)} ~~ as ~~ description\\
% \end{eqnarray*}
% \caption{Description}\label{fig:description}
% \end{figure}
% % ?general description, features
% ODL uses a type system and spatial description to
% describe data on medical images.
% Base types describe atomic pieces of data or represent
% spatial information and complex types describe how
% to build compund descriptions from simpler ones. ODL
% also use additional information to provide constrains
% based on doctors' knowledge.
% Besides the description of the data itself,
% ODL provides spatial description expression to allow users
% to descrbe the physical layout of the data on the image.


% \input{expression}
% abstract syntax and type
% example

\subsubsection{Type System}
\input{typingrulefig}

In ODL, we can assign a type to every value and expression. We set up some rules  determining types for values and expressions, which make up a complete type system.The type system of ODL is shown in \figref{fig:type} and \figref{fig:typingrule}. \figref{fig:type} shows the basic principles for detemining types and Figure 10 extends it by giving some judgement forms which can be seen as inductive typing rules.
\textit{T-VARIABLE} indicates that the type of \textit{name} expression is based on
the type of name in the typing context. \textit{T-INT ARITH}, \textit{T-INT REL},
\textit{T-FLOAT ARITH} and \textit{T-FLOAT REL}
indicate that the two expressions of the \textit{bop} are of the same type, int or float, and
the final type of the \textit{bop} expression is based on the binary operation.
\textit{T-CONSTRAINT} indicates that the types of the expressions
in the constraints have nothing to do with the
final type of the \textit{constraints} expression, which is the same as the original
expression \textit{$e_0$}.
\textit{T-HSKIP} and \textit{T-VSKIP} are rules for two spatial expressions.
The expression \textit{e} in \textit{horizontal skip} and \textit{vertical skip}
should have spatial parameters and be of the \textit{len} type. The type of
these two expressions should be \textit{unit}. The last three of all the typing rules are for
the composition expressions. \textit{T-STRUCT} indicates that the type
of \textit{struct} is the combination of the types of all sub-expressions.
\textit{T-UNION} indicates that the type of \textit{union} can be
any type of the sub-expressions. \textit{T-LIST} indicates that the type of
\textit{list} is a sequence of the same type.
% \textit{unit} type are for the
% expression of \textit{()} value. \textit{int}, \textit{float} and \textit{float} are types
% of the expressions that can be parsed into these type of values. \textit{len} is
% the type of \textit{len} value. The rest four kinds of types are the combination of
% all the types. \textit{$\langle len ~~ len, ~~ len, ~~ len\rangle$} is the type for
% \textit{coord}. \textit{$\{t_1 + t_2 + ... + t_n\}$} is the type for \textit{union} expression, which
% means the type of the value of \textit{union} can be any type of the components of the expression.
% \textit{$\{l_1 : t_1, ~~ ..., ~~ l_n : t_n\}$} is the type for \textit{struct}. All the types of
% the subexpressions in \textit{struct} are recorded. Finally, \textit{t ~~ list} is the type for
% \textit{list}. \textit{list} is made up of a sequence of the expressions in the same type.
% In \figref{fig:typingrule}, the detailed typing rules are described. Other than the types
% of the expressions, \textit{T-INT ARITH}, \textit{T-INT REL}, \textit{T-FLOAT ARITH} and \textit{T-FLOAT REL}
% indicate that the two expressions of the \textit{bop} shown be in the same type, int or float, and
% the final type of the \textit{bop} expression is based on the binary operation. \textit{T-CONSTRAINS}
% indicates that the types of the expressions in the constraints have nothing to do with the
% final type of the \textit{constranints} expression.
