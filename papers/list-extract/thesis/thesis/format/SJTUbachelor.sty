%% Author: Yunfeng Tao
%% Date: May. 3, 2007
%% Description:
%% styles for Bachelor Thesis of SJTU


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{SJTUbachelor}[2007/06/09 v1.0 (TYF)]
\let\bach@indentthmprf=0
\DeclareOption{indentthmprf}{\let\bach@indentthmprf=1}
\ProcessOptions

\RequirePackage{times}
\RequirePackage{fancyhdr}
\RequirePackage[numbers,sort&compress]{natbib}
\RequirePackage{hypernat}
\RequirePackage[dvipdfm,%
            CJKbookmarks]{hyperref}
\RequirePackage[%paperwidth=18.4cm, paperheight= 26cm,
            body={14.5true cm,24.62true cm},%for sjtu standard
            %twosideshift=0 pt,
            hmarginratio=2:2,%3:2 for double printing, modified by arealme
            top=3.17cm,
            bottom=3.17cm,
            %headheight=1.0true cm
            ]{geometry}
\RequirePackage{lastpage}
\RequirePackage{subfig}
\RequirePackage{color}
\RequirePackage{extarrows}
\RequirePackage{amsfonts, amssymb, amsmath, amscd, eucal, amsthm}
\RequirePackage{array}
\RequirePackage{enumerate}
\RequirePackage[dvips]{graphicx}
\RequirePackage{url}
\RequirePackage{xcolor}  %%[新加项:Dachang Wang, May 2009]
\RequirePackage{listings} %%[新加项:Dachang Wang, April 2009]

%% 设置定理环境
\ifx\bach@indentthmprf1
    \newtheoremstyle{mythm}{3pt}{3pt}{\itshape}{\parindent}{\bfseries}{.}{0.5em}{}
    \theoremstyle{mythm}
    \newtheorem{theorem}{Theorem}
    \newtheorem{lemma}[theorem]{Lemma}
    \newtheorem{corollary}[theorem]{Corollary}
    \newtheorem{proposition}[theorem]{Proposition}
\else
    \theoremstyle{plain}
    \newtheorem{theorem}{Theorem}
    \newtheorem{lemma}[theorem]{Lemma}
    \newtheorem{corollary}[theorem]{Corollary}
    \newtheorem{proposition}[theorem]{Proposition}
\fi
\theoremstyle{definition}
\newtheorem{definition}{Definition}
\newtheorem{example}{Example}[section]
\theoremstyle{remark}
\newtheorem{remark}{Remark}[section]
\renewcommand{\proofname}{Proof}

%% 字体
\newcommand{\yihao}{\fontsize{26pt}{36pt}\selectfont}    % 一号, 1.4倍行距
\newcommand{\erhao}{\fontsize{22pt}{28pt}\selectfont}    % 二号, 1.25倍行距
\newcommand{\xiaoerhao}{\fontsize{18pt}{18pt}\selectfont}    % 小二, 单倍行距
\newcommand{\sanhao}{\fontsize{16pt}{24pt}\selectfont}    % 三号, 1.5倍行距
\newcommand{\xiaosanhao}{\fontsize{15pt}{22pt}\selectfont}    % 小三, 1.5倍行距
\newcommand{\sihao}{\fontsize{14pt}{14pt}\selectfont}    % 四号, 1.25倍行距 by arealme
\newcommand{\banxiaosihao}{\fontsize{13pt}{19.5pt}\selectfont}    % 半小四, 1.5倍行距
\newcommand{\xiaosihao}{\fontsize{12pt}{18pt}\selectfont}    % 小四, 1.5倍行距
\newcommand{\dawuhaohao}{\fontsize{11pt}{11pt}\selectfont}    % 大五号, 单倍行距
\newcommand{\wuhao}{\fontsize{10.5pt}{10.5pt}\selectfont}    % 五号, 单倍行距
\newcommand{\xiaowuhao}{\fontsize{9pt}{9pt}\selectfont}    % 小五号, 单倍行距        [新加项:Dachang Wang, April 2009]
\newcommand{\liuhao}{\fontsize{7.5pt}{7.5pt}\selectfont}    % 六号, 单倍行距         [新加项:Dachang Wang, April 2009]
\newcommand{\xiaoliuhao}{\fontsize{6.5pt}{6.5pt}\selectfont}    % 小六号, 单倍行距   [新加项:Dachang Wang, April 2009]
\newcommand{\saerhao}{\fontsize{32pt}{64pt}\selectfont}
\newcommand{\sanhaoH}{\fontsize{16pt}{20pt}\selectfont}
\songti\wuhao

%% 封面
\renewcommand{\title}[1]{\def\bach@title{#1}}
\newcommand{\entitle}[1]{\def\bach@entitle{#1}}
\renewcommand{\author}[1]{\def\bach@author{#1}}
\newcommand{\teacher}[1]{\def\bach@teacher{#1}}
\newcommand{\department}[1]{\def\bach@depart{#1}}
\newcommand{\major}[1]{\def\bach@major{#1}}
\newcommand{\idno}[1]{\def\bach@idno{#1}}
\def\bach@title{}
\def\bach@entitle{}
\def\bach@author{}
\def\bach@teacher{}
\def\bach@depart{}
\def\bach@major{}
\def\bach@idno{}
\renewcommand{\maketitle}{%
    \thispagestyle{empty}%
    \begin{center}%
    \vspace*{2.2cm}%
    \includegraphics[width=.72\textwidth]{innerCover-sjtu-hanzi.eps}\\
    \vspace*{1.5em}
    {\xiaoerhao \bf SHANGHAI JIAO TONG UNIVERSITY}\\
    \vspace*{2.5em}
    {\saerhao \kaishu 学士学位论文}\\
    \vspace*{1.5em}
    {\xiaoerhao \bf THESIS OF BACHELOR}\\
    \vspace*{1.5em}
    \includegraphics[width=.2\textwidth]{innerCover-sjtu-xiaohui.eps}\\
    \vspace*{2.5cm}%
    {\zihao{2} \kaishu 论文题目：}{\zihao{3}\kaishu \bach@title}%\\
    \vfill%
    %    \\[1cm]%
%        {\bf\zihao{2} {}}%\bach@entitle}%
%        \vfill%
    {%
        \sanhaoH%
        \kaishu%
        \begin{tabular}{cc}%
        {学生姓名：}&\bach@author\\
        {学生学号：}&\bach@idno\\
        {专\qquad 业：}&\bach@major\\
        {指导教师：}&\bach@teacher\\
        {学院\ (系)：}&\bach@depart
        \end{tabular}%
    }%
    %\vfill%
    \end{center}%
    \clearpage%
}


%% 目录等的页眉
\let\orig@frontmatter=\frontmatter
\renewcommand{\frontmatter}{%
    \orig@frontmatter%
    \fancypagestyle{plain}{%
    \fancyhead{}%
    \fancyhead[L]{\includegraphics[width=4cm]{sjtu.eps}}%
    %[修改项:Dachang Wang, April 2009]
    %%% 按SJTU-jwc要求把页眉更改为小五号字体
    \fancyhead[R]{{\bf\xiaowuhao\bach@entitle}}%
        \fancyfoot{}
    }%
    \pagestyle{plain}
}

%%
\renewcommand*\l@chapter[2]{%
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}%
    %\vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode %\bfseries
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      #1\nobreak\hfil
      \leaders\hbox
      {$\m@th                %modified by Zhenxiao Li
      \mkern \@dotsep mu\hbox{.}\mkern \@dotsep
      mu$}
      \hfill \nobreak\hb@xt@\@pnumwidth{\hss #2}\par
      \penalty\@highpenalty
    \endgroup
  \fi}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%[修改项:Mohan Yang, May 2010]
%%% 添加此段代码后，目录中就是"------"，而非".........."
\def\@strigulaedtocline#1#2#3#4#5{
    \ifnum #1>\c@tocdepth
    \else
      \vskip \z@ \@plus.2\p@
      {\leftskip #2\relax \rightskip\@tocrmarg \parfillskip -\rightskip
       \parindent #2\relax\@afterindenttrue
       \interlinepenalty\@M
       \leavevmode
       \@tempdima #3\relax
       \advance\leftskip \@tempdima\null\nobreak\hskip -\leftskip {#4}\nobreak
       \leaders\hbox{-}\hfill
       \nobreak
       \hb@xt@\@pnumwidth{\hfil\normalfont \normalcolor #5}
       \par}
\fi}

\renewcommand*\l@chapter{\@strigulaedtocline{1}{0em}{0.0em}}
\renewcommand*\l@section{\@strigulaedtocline{1}{1.5em}{2.3em}}
\renewcommand*\l@subsection{\@strigulaedtocline{2}{3.8em}{3.2em}}
\renewcommand*\l@subsubsection{\@strigulaedtocline{3}{7.0em}{4.1em}}
\renewcommand*\l@paragraph{\@strigulaedtocline{4}{10em}{5em}}
\renewcommand*\l@subparagraph{\@strigulaedtocline{5}{12em}{6em}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% 中文摘要和关键词
\newenvironment{chnabstract}[1][]{%
        \thispagestyle{plain}%
    \fancyfoot{}%
    \def\bach@keywords{#1}%
        \vspace*{-20pt}%
        \begin{center}%
                \sanhao\vspace*{\baselineskip}%
        {\bf\sanhao\bach@title}%
        \\[\baselineskip]%
                {\bf\zihao{4} 摘要}%
                \\[\baselineskip]
    \end{center}
    \par%
}{%
    \par%
    \vspace{1em}%
    \noindent%
    {\bf\xiaosihao 关键词：}\quad{\bach@keywords}%
    \let\bach@keywords=\relax%
    \clearpage%
    \setcounter{page}{0}%
}

%% 英文摘要和关键词
\newenvironment{enabstract}[1]{%
        \thispagestyle{plain}%
    \fancyfoot{}%
    \def\bach@keywords{#1}%
        \vspace*{-20pt}%
        \begin{center}%
                \sanhao\vspace*{\baselineskip}%
        {\bf\sanhao\bach@entitle}%
        \\[\baselineskip]%
                {\bf\sihao ABSTRACT}%
                \\[\baselineskip]
    \end{center}
    \par%
}{%
    \par%
    \vspace{1em}%
    \noindent%
    {\bf\xiaosihao Key words:}\quad{\bach@keywords}%
    \let\bach@keywords=\relax%
    \clearpage%
    \setcounter{page}{0}%
}


%% 引用文献格式
\let\textcite=\cite
\renewcommand{\cite}[1]{\textsuperscript{\liuhao\textcite{#1}}}
\let\origbibliographystyle=\bibliographystyle
\renewcommand{\bibliographystyle}[1]{\addcontentsline{toc}{chapter}{Bibliography}\origbibliographystyle{#1}}

%% 正文
\def\chapterformat{\sanhao\bfseries\centering}
\def\@makechapterhead#1{%
  \vspace*{-\headsep}\vspace*{-\headheight}\vspace*{15\p@}%
  {\sanhao\vspace*{\baselineskip}
  \chapterformat%                        !!!
    \ifnum \c@secnumdepth >\m@ne%                                !!!
      \if@mainmatter%                                            !!!
        \chaptername \quad #1 \par\nobreak%      !!!
      \else%                                                     !!!
        #1 \par\nobreak%                         !!!
      \fi%                                                       !!!
    \fi%                                                         !!!
  \vspace{\baselineskip}%
  }%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%[新加项:Dachang Wang, April 2009]
%% 添加此段代码后，“目录”，“参考文献”“谢辞”等处均能上下各空一行
\def\@makeschapterhead#1{%
  \vspace*{-\headsep}\vspace*{-\headheight}\vspace*{15\p@}%   !!!
  {\sanhao\vspace*{\baselineskip}
  \chapterformat%                        !!!
    \interlinepenalty\@M%                                     !!!
    #1\par\nobreak%                                           !!!
    \vspace{\baselineskip}%                                  !!!
  }
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\def\sectionname{\thechapter.\arabic{section}}
\def\sectionformat{ {\wuhao\indent}\zihao{4}\bf}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%[新加项:Dachang Wang, May 2009]
%% 添加此段代码后，三、四级标题的编号就不是黑体了，而是正常的宋体
\renewcommand\subsection{\@startsection
            {subsection}{3}{\z@}%   {name}{depth}{}
                {1.75ex \@plus 0.5ex \@minus .1ex}% positive->leave parindent
                {1.15ex \@plus.1ex}%
                {\protected@xdef\@currentlabel{\subsectionname}%
             \reset@font\normalsize\subsectionformat}}
\renewcommand\subsubsection{\@startsection
            {subsubsection}{4}{\z@}%   {name}{depth}{}
                {1.75ex \@plus 0.5ex \@minus .1ex}% positive->leave parindent
                {1.15ex \@plus.1ex}%
                {\protected@xdef\@currentlabel{\subsubsectionname}%
             \reset@font\normalsize\subsubsectionformat}}
\def\subsectionformat{\indent\xiaosihao\songti}
\def\subsubsectionformat{\indent\wuhao\songti}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%[新加项:Dachang Wang, May 2009]
%% 添加此段代码后，公式、图、表的编号就是“3-1”,而非“3.1”之类
\renewcommand\theequation
  {\ifnum \c@chapter>\z@ \thechapter-\fi \@arabic\c@equation}
\renewcommand \thefigure
     {\ifnum \c@chapter>\z@ \thechapter-\fi \@arabic\c@figure}
\renewcommand \thetable
     {\ifnum \c@chapter>\z@ \thechapter-\fi \@arabic\c@table}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%
\let\orig@mainmatter=\mainmatter
\def\mainmatter{%
    \orig@mainmatter%
        %% 页眉页脚
    \fancypagestyle{plain}{%
        \fancyfoot{}%
        %% 按SJTU-jwc要求把页脚更改为小五号字体 [修改项:Dachang Wang, April 2009]
        \fancyfoot[C]{\xiaowuhao{Page \hspace{0.1cm}\thepage\hspace{0.1cm}\quad Total \hspace{0.1cm}\pageref*{LastPage}\hspace{0.1cm}}}%
    }
    \pagestyle{fancy}
    \fancyhead{}%
    \fancyhead[L]{\includegraphics[width=4cm]{sjtu.eps}}
    %% 按SJTU-jwc要求把页眉更改为小五号字体 [修改项:Dachang Wang, April 2009]
    \fancyhead[R]{{\bf\xiaowuhao\bach@entitle}}
    \fancyfoot{}%
    %% 按SJTU-jwc要求把页脚更改为小五号字体 [修改项:Dachang Wang, April 2009]
    \fancyfoot[C]{\xiaowuhao{Page \hspace{0.1cm}\thepage\hspace{0.1cm}\quad Total \hspace{0.1cm}\pageref*{LastPage}\hspace{0.1cm}}}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% [新加项:Dachang Wang, April 2009]
%% 使之显示为“附录A，A.1... A.2...”
%% 而非“附录一，A.1... A.2...”
\renewcommand\appendixname{Appendix\,\Alph{chapter}}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% [新加项:Dachang Wang, April 2009]
%% 使"表"与“图”显示为“宋体字，
\renewcommand\figurename{\rm Figure}%
\renewcommand\tablename{\rm Table}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




