\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{inference-rules}

% Inference rule environment with symbolic label and cross-reference.
% Use \begin{inferencerule}{rule-name} ... \end{inferencerule} to define a
% rule.
% Use \ruleref{rule-name} to refer to it.
% The label appears on the left so as to avoid clashing with the side
% conditions on the right.

\makeatletter{}
\def\rulelabel#1{\if@filesw{\let\thepage\relax\xdef\@gtempa{\write\@auxout{\string\newlabel{#1}{{#1}{\thepage}}}}}\@gtempa\fi}
\makeatother{}
\newcommand{\rulefont}{\scshape}
\newcommand{\ruleref}[1]{\ifmmode\mbox{\rulefont\ref{#1}}\else{\rulefont\ref{#1}}\fi}

\newenvironment{inferencerule}[1]{\xdef\theinferencerule{#1}\rulelabel{#1}$$}{\eqno\inferencerulename$$}

% For labels on the right:
% The parameter \rulenamewidth should be set to an upper bound on the width of
% a rule name (I don't know any other way to handle the problem of avoiding
% overlap of the name with the rule itself for wide rules!)
\newlength{\rulenamewidth}
\setlength{\rulenamewidth}{.75in}
\newcommand{\inferencerulename}{\hbox to \rulenamewidth{}\llap{\rulefont(\theinferencerule)}}
% labels on the left:
%\newcommand{\inferencerulename}{\hbox to .01pt{}\rlap{\rulefont\hskip-\displaywidth(\theinferencerule)}}


% Type setting inference rules is a real pain.  These macros handle three
% commonly-occurring cases: axioms, plain rules, and rules with stacked
% premises.  It is assumed that we are in display math mode.
% Side conditions are particularly problematic since they usually clash with
% the label.

\newcommand{\axiom}[2]{{\displaystyle\strut{#1}}\quad{\displaystyle{#2}}}

\newcommand{\infrule}[3]{{{\displaystyle\strut{#1}}\over{\displaystyle\strut{#2}}}\quad{\displaystyle{#3}}}

\newcommand{\stackrule}[4]{%
{\shortstack{$\displaystyle\strut{#1}$\\$\displaystyle{#2}$}\over{\displaystyle\strut{#3}}}\quad{\displaystyle{#4}}}

\newcommand{\stackstackrule}[5]{%
{\shortstack{$\displaystyle\strut{#1}$\\$\displaystyle\strut{#2}$\\$\displaystyle\strut{#3}$}\over{\displaystyle\strut{#4}}}\quad{\displaystyle{#5}}}
