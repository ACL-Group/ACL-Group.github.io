\subsubsection*{Bob and Jill (BJ)}

This example is about trading in an online marketplace. 
Photographer Bob wants to upgrade his equipment while Jill wants to downgrade.
Bob can either buy good lens and sell his average lens, 
or buy a good camera and sell his average camera.
Jill can either sell her good lens and buy an average camera, 
or sell her good camera and buy an average camera.
Listing \ref{lst:bob} and \ref{lst:jill} show the 
agent programs of Bob and Jill, respectively.
Both \texttt{buy()} and \texttt{sell()} are blocking and implemented in Listing \ref{lst:bjcom}.
\texttt{id()} returns a unique transaction number for each invocation.

\begin{figure}[tb]
\begin{lstlisting}[label=lst:bob,caption=Bob's Agent]
(buy(goodlens); sell(avglens); |$\cm$|)
|$\oplus$| (buy(goodcam); sell(avgcam); |$\cm$|)
|$\exit$|
\end{lstlisting}
\begin{lstlisting}[label=lst:jill,caption=Jill's Agent]
(sell(goodlens); buy(avgcam); |$\cm$|)
|$\oplus$| (buy(goodcam); buy(avgcam); |$\cm$|)
|$\exit$|
\end{lstlisting}
\begin{lstlisting}[label=lst:bjcom,caption=Common Routines for Trading]
sell(X): I = id(); |$\Out$|(sell,X,I); |$\In$|(buy,X,I)
buy(X):  (_,_,I) = |$\In$|(sell,X,_); |$\Out$|(buy,X,I)
\end{lstlisting}
\end{figure}

\TODO{include a tree of BJ?}
